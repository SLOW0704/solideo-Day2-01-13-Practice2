<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì¤‘êµí†µ ê²½ë¡œ ì‹œê°í™” ì‹œìŠ¤í…œ</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0;
            min-height: calc(100vh - 200px);
        }

        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .preferences {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .preferences h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #333;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .checkbox-label:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .checkbox-label input {
            width: auto;
        }

        .map-container {
            position: relative;
        }

        #map {
            width: 100%;
            height: calc(100vh - 200px);
        }

        .route-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 350px;
            z-index: 1000;
            max-height: calc(100vh - 280px);
            overflow-y: auto;
        }

        .route-info h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .route-segment {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .route-icon {
            font-size: 1.5em;
            min-width: 30px;
        }

        .route-details {
            flex: 1;
        }

        .route-details h4 {
            font-size: 1em;
            margin-bottom: 5px;
            color: #333;
        }

        .route-details p {
            font-size: 0.9em;
            color: #666;
            margin: 3px 0;
        }

        .recommendations {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 350px;
            z-index: 1000;
        }

        .recommendations h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #333;
        }

        .recommendation-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recommendation-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .recommendation-item h4 {
            font-size: 0.95em;
            color: #333;
            margin-bottom: 3px;
        }

        .recommendation-item p {
            font-size: 0.85em;
            color: #666;
        }

        .transport-icon {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 5px;
        }

        .transport-bus {
            background: #4caf50;
            color: white;
        }

        .transport-train {
            background: #2196f3;
            color: white;
        }

        .transport-plane {
            background: #ff9800;
            color: white;
        }

        .transport-walk {
            background: #9e9e9e;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .loading.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                max-height: none;
            }

            #map {
                height: 600px;
            }

            .route-info,
            .recommendations {
                position: relative;
                top: auto;
                right: auto;
                bottom: auto;
                max-width: 100%;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸšŒ ëŒ€ì¤‘êµí†µ ê²½ë¡œ ì‹œê°í™”</h1>
            <p>ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ì…ë ¥í•˜ê³  ìµœì ì˜ ê²½ë¡œë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <form id="routeForm">
                    <div class="form-group">
                        <label for="departure">ì¶œë°œ ê±´ë¬¼/ìœ„ì¹˜</label>
                        <input type="text" id="departure" placeholder="ì˜ˆ: ì„œìš¸ì—­" required>
                    </div>

                    <div class="form-group">
                        <label for="arrival">ë„ì°© ê±´ë¬¼/ìœ„ì¹˜</label>
                        <input type="text" id="arrival" placeholder="ì˜ˆ: ë¶€ì‚°ì—­" required>
                    </div>

                    <div class="form-group">
                        <label for="departureTime">ì¶œë°œ ì‹œê°„</label>
                        <input type="datetime-local" id="departureTime" required>
                    </div>

                    <div class="form-group">
                        <label for="travelDuration">ì—¬í–‰ ê¸°ê°„ (ì¼)</label>
                        <input type="number" id="travelDuration" min="1" max="30" value="1" placeholder="1">
                    </div>

                    <div class="form-group">
                        <label for="transportMode">ì„ í˜¸ êµí†µìˆ˜ë‹¨</label>
                        <select id="transportMode">
                            <option value="all">ëª¨ë“  ìˆ˜ë‹¨</option>
                            <option value="bus">ë²„ìŠ¤ ìš°ì„ </option>
                            <option value="train">ê¸°ì°¨ ìš°ì„ </option>
                            <option value="plane">ë¹„í–‰ê¸° í¬í•¨</option>
                            <option value="eco">ì¹œí™˜ê²½ (ë²„ìŠ¤/ê¸°ì°¨)</option>
                        </select>
                    </div>

                    <button type="submit" class="btn">ğŸ” ê²½ë¡œ ê²€ìƒ‰</button>

                    <div class="preferences">
                        <h3>ì—¬í–‰ ì·¨í–¥ ì„¤ì •</h3>

                        <label style="font-weight: 600; font-size: 0.9em; color: #666; margin-bottom: 10px; display: block;">ê´€ì‹¬ ì—¬í–‰ì§€</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="interest" value="historical">
                                ì—­ì‚¬/ë¬¸í™”
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="interest" value="nature">
                                ìì—°/íë§
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="interest" value="shopping">
                                ì‡¼í•‘
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="interest" value="cafe">
                                ì¹´í˜
                            </label>
                        </div>

                        <label style="font-weight: 600; font-size: 0.9em; color: #666; margin: 15px 0 10px 0; display: block;">ìŒì‹ ì·¨í–¥</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="food" value="korean">
                                í•œì‹
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="food" value="western">
                                ì–‘ì‹
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="food" value="japanese">
                                ì¼ì‹
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="food" value="chinese">
                                ì¤‘ì‹
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="food" value="local">
                                í–¥í† ìŒì‹
                            </label>
                        </div>
                    </div>
                </form>

                <div class="loading" id="loading">
                    ê²½ë¡œë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¤‘...
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>

                <div class="route-info" id="routeInfo" style="display: none;">
                    <h3>ğŸš ê²½ë¡œ ì •ë³´</h3>
                    <div id="routeDetails"></div>
                </div>

                <div class="recommendations" id="recommendations" style="display: none;">
                    <h3>ğŸ“ ì¶”ì²œ ì¥ì†Œ</h3>
                    <div id="recommendationsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // ì§€ë„ ì´ˆê¸°í™”
        const map = L.map('map').setView([37.5665, 126.9780], 7);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // ë§ˆì»¤ ê·¸ë£¹
        let markersLayer = L.layerGroup().addTo(map);
        let routeLayer = L.layerGroup().addTo(map);

        // ì£¼ìš” ë„ì‹œ ì¢Œí‘œ ë°ì´í„°
        const locations = {
            'ì„œìš¸ì—­': { lat: 37.5547, lng: 126.9707 },
            'ê°•ë‚¨ì—­': { lat: 37.4979, lng: 127.0276 },
            'ë¶€ì‚°ì—­': { lat: 35.1151, lng: 129.0419 },
            'ëŒ€êµ¬': { lat: 35.8714, lng: 128.6014 },
            'ëŒ€ì „': { lat: 36.3504, lng: 127.3845 },
            'ê´‘ì£¼': { lat: 35.1595, lng: 126.8526 },
            'ì¸ì²œ': { lat: 37.4563, lng: 126.7052 },
            'ì œì£¼': { lat: 33.4996, lng: 126.5312 },
            'ê²½ì£¼': { lat: 35.8562, lng: 129.2247 },
            'ì „ì£¼': { lat: 35.8242, lng: 127.1480 }
        };

        // êµí†µ ìˆ˜ë‹¨ ì•„ì´ì½˜
        const transportIcons = {
            bus: 'ğŸšŒ',
            train: 'ğŸš„',
            plane: 'âœˆï¸',
            walk: 'ğŸš¶'
        };

        // ì¶”ì²œ ì¥ì†Œ ë°ì´í„°
        const recommendations = {
            'ì„œìš¸ì—­': [
                { type: 'historical', name: 'ê²½ë³µê¶', desc: 'ì¡°ì„ ì‹œëŒ€ ê¶ê¶', category: 'ì—­ì‚¬/ë¬¸í™”' },
                { type: 'shopping', name: 'ëª…ë™', desc: 'ì‡¼í•‘ ê±°ë¦¬', category: 'ì‡¼í•‘' },
                { type: 'cafe', name: 'ë¶ì´Œí•œì˜¥ë§ˆì„', desc: 'ì „í†µ ì¹´í˜', category: 'ì¹´í˜' },
                { type: 'korean', name: 'ê´‘ì¥ì‹œì¥', desc: 'ì „í†µ í•œì‹ ì‹œì¥', category: 'í•œì‹' }
            ],
            'ê°•ë‚¨ì—­': [
                { type: 'shopping', name: 'ì½”ì—‘ìŠ¤ëª°', desc: 'ëŒ€í˜• ì‡¼í•‘ëª°', category: 'ì‡¼í•‘' },
                { type: 'cafe', name: 'ê°€ë¡œìˆ˜ê¸¸', desc: 'íŠ¸ë Œë””í•œ ì¹´í˜ê±°ë¦¬', category: 'ì¹´í˜' },
                { type: 'western', name: 'ì²­ë‹´ë™', desc: 'ê³ ê¸‰ ì–‘ì‹ë‹¹', category: 'ì–‘ì‹' }
            ],
            'ë¶€ì‚°ì—­': [
                { type: 'nature', name: 'í•´ìš´ëŒ€', desc: 'ì•„ë¦„ë‹¤ìš´ í•´ë³€', category: 'ìì—°/íë§' },
                { type: 'historical', name: 'ê°ì²œë¬¸í™”ë§ˆì„', desc: 'ì˜ˆìˆ  ë§ˆì„', category: 'ì—­ì‚¬/ë¬¸í™”' },
                { type: 'local', name: 'ìê°ˆì¹˜ì‹œì¥', desc: 'ì‹ ì„ í•œ í•´ì‚°ë¬¼', category: 'í–¥í† ìŒì‹' },
                { type: 'cafe', name: 'ì†¡ë„í•´ìˆ˜ìš•ì¥', desc: 'ë°”ë‹¤ë·° ì¹´í˜', category: 'ì¹´í˜' }
            ],
            'ì œì£¼': [
                { type: 'nature', name: 'í•œë¼ì‚°', desc: 'ì œì£¼ì˜ ìƒì§• ì‚°', category: 'ìì—°/íë§' },
                { type: 'nature', name: 'ì„±ì‚°ì¼ì¶œë´‰', desc: 'ì¼ì¶œ ëª…ì†Œ', category: 'ìì—°/íë§' },
                { type: 'local', name: 'í‘ë¼ì§€ ê±°ë¦¬', desc: 'ì œì£¼ í‘ë¼ì§€', category: 'í–¥í† ìŒì‹' },
                { type: 'cafe', name: 'ì• ì›” ì¹´í˜ê±°ë¦¬', desc: 'ë°”ë‹¤ë·° ì¹´í˜', category: 'ì¹´í˜' }
            ]
        };

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('routeForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const departure = document.getElementById('departure').value;
            const arrival = document.getElementById('arrival').value;
            const departureTime = document.getElementById('departureTime').value;
            const travelDuration = document.getElementById('travelDuration').value;
            const transportMode = document.getElementById('transportMode').value;

            // ì‚¬ìš©ì ì·¨í–¥ ìˆ˜ì§‘
            const interests = Array.from(document.querySelectorAll('input[name="interest"]:checked'))
                .map(cb => cb.value);
            const foodPrefs = Array.from(document.querySelectorAll('input[name="food"]:checked'))
                .map(cb => cb.value);

            // ë¡œë”© í‘œì‹œ
            document.getElementById('loading').classList.add('active');

            // ì‹œë®¬ë ˆì´ì…˜ ì§€ì—°
            await new Promise(resolve => setTimeout(resolve, 1000));

            // ê²½ë¡œ ìƒì„±
            generateRoute(departure, arrival, transportMode, departureTime, travelDuration);

            // ì¶”ì²œ ì¥ì†Œ í‘œì‹œ
            showRecommendations(arrival, interests, foodPrefs);

            // ë¡œë”© ìˆ¨ê¹€
            document.getElementById('loading').classList.remove('active');
        });

        function findLocation(query) {
            // ì •í™•í•œ ë§¤ì¹­ ì°¾ê¸°
            for (const [name, coords] of Object.entries(locations)) {
                if (name.includes(query) || query.includes(name.replace('ì—­', ''))) {
                    return { name, ...coords };
                }
            }

            // ê¸°ë³¸ê°’ (ì„œìš¸)
            return { name: query, lat: 37.5665, lng: 126.9780 };
        }

        function generateRoute(departure, arrival, mode, time, duration) {
            // ë ˆì´ì–´ ì´ˆê¸°í™”
            markersLayer.clearLayers();
            routeLayer.clearLayers();

            // ì¶œë°œì§€ì™€ ë„ì°©ì§€ ì¢Œí‘œ ì°¾ê¸°
            const startLoc = findLocation(departure);
            const endLoc = findLocation(arrival);

            // ë§ˆì»¤ ì¶”ê°€
            const startMarker = L.marker([startLoc.lat, startLoc.lng], {
                icon: L.divIcon({
                    html: '<div style="background: #4caf50; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">ğŸ</div>',
                    className: '',
                    iconSize: [40, 40]
                })
            }).addTo(markersLayer);
            startMarker.bindPopup(`<b>ì¶œë°œ: ${departure}</b><br>${new Date(time).toLocaleString('ko-KR')}`);

            const endMarker = L.marker([endLoc.lat, endLoc.lng], {
                icon: L.divIcon({
                    html: '<div style="background: #f44336; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">ğŸ¯</div>',
                    className: '',
                    iconSize: [40, 40]
                })
            }).addTo(markersLayer);
            endMarker.bindPopup(`<b>ë„ì°©: ${arrival}</b><br>ì˜ˆìƒ ${duration}ì¼ ì—¬í–‰`);

            // ê²½ë¡œ ìƒì„± (ì—¬ëŸ¬ êµí†µìˆ˜ë‹¨)
            const routes = generateTransportRoute(startLoc, endLoc, mode);

            // ê²½ë¡œ ì„  ê·¸ë¦¬ê¸°
            let allPoints = [[startLoc.lat, startLoc.lng]];

            routes.forEach((route, index) => {
                const color = getTransportColor(route.type);

                if (route.waypoint) {
                    allPoints.push([route.waypoint.lat, route.waypoint.lng]);

                    // ì¤‘ê°„ ì§€ì  ë§ˆì»¤
                    L.marker([route.waypoint.lat, route.waypoint.lng], {
                        icon: L.divIcon({
                            html: `<div style="background: ${color}; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.2);">${transportIcons[route.type]}</div>`,
                            className: '',
                            iconSize: [30, 30]
                        })
                    }).addTo(markersLayer).bindPopup(`<b>${route.name}</b><br>${route.time}`);
                }

                // ê²½ë¡œì„ 
                const routeLine = L.polyline(route.points, {
                    color: color,
                    weight: 4,
                    opacity: 0.7,
                    dashArray: route.type === 'walk' ? '10, 10' : null
                }).addTo(routeLayer);

                routeLine.bindPopup(`<b>${route.name}</b><br>${route.time}<br>${route.distance}`);
            });

            allPoints.push([endLoc.lat, endLoc.lng]);

            // ì§€ë„ ë²”ìœ„ ì¡°ì •
            map.fitBounds(allPoints);

            // ê²½ë¡œ ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸
            displayRouteInfo(routes, time);
        }

        function generateTransportRoute(start, end, mode) {
            const distance = Math.sqrt(
                Math.pow(end.lat - start.lat, 2) +
                Math.pow(end.lng - start.lng, 2)
            );

            let routes = [];

            if (distance > 5 || mode === 'plane') {
                // ì¥ê±°ë¦¬ - ë¹„í–‰ê¸° í¬í•¨
                const midLat = (start.lat + end.lat) / 2 + (Math.random() - 0.5) * 0.5;
                const midLng = (start.lng + end.lng) / 2 + (Math.random() - 0.5) * 0.5;

                routes.push({
                    type: 'bus',
                    name: 'ì‹œë‚´ë²„ìŠ¤ 370ë²ˆ',
                    time: '15ë¶„',
                    distance: '5.2km',
                    waypoint: { lat: start.lat + 0.05, lng: start.lng + 0.05 },
                    points: [
                        [start.lat, start.lng],
                        [start.lat + 0.05, start.lng + 0.05]
                    ]
                });

                if (mode === 'plane' || distance > 8) {
                    routes.push({
                        type: 'plane',
                        name: 'ëŒ€í•œí•­ê³µ KE1234',
                        time: '1ì‹œê°„ 20ë¶„',
                        distance: '400km',
                        waypoint: { lat: midLat, lng: midLng },
                        points: [
                            [start.lat + 0.05, start.lng + 0.05],
                            [midLat, midLng],
                            [end.lat - 0.05, end.lng - 0.05]
                        ]
                    });
                } else {
                    routes.push({
                        type: 'train',
                        name: 'KTX 123',
                        time: '2ì‹œê°„ 30ë¶„',
                        distance: '350km',
                        waypoint: { lat: midLat, lng: midLng },
                        points: [
                            [start.lat + 0.05, start.lng + 0.05],
                            [midLat, midLng],
                            [end.lat - 0.05, end.lng - 0.05]
                        ]
                    });
                }

                routes.push({
                    type: 'walk',
                    name: 'ë„ë³´ ì´ë™',
                    time: '10ë¶„',
                    distance: '800m',
                    points: [
                        [end.lat - 0.05, end.lng - 0.05],
                        [end.lat, end.lng]
                    ]
                });
            } else {
                // ë‹¨ê±°ë¦¬ - ë²„ìŠ¤/ê¸°ì°¨
                const mid1Lat = start.lat + (end.lat - start.lat) * 0.3;
                const mid1Lng = start.lng + (end.lng - start.lng) * 0.3;
                const mid2Lat = start.lat + (end.lat - start.lat) * 0.7;
                const mid2Lng = start.lng + (end.lng - start.lng) * 0.7;

                routes.push({
                    type: 'bus',
                    name: 'ì‹œë‚´ë²„ìŠ¤ 370ë²ˆ',
                    time: '25ë¶„',
                    distance: '12.5km',
                    waypoint: { lat: mid1Lat, lng: mid1Lng },
                    points: [
                        [start.lat, start.lng],
                        [mid1Lat, mid1Lng]
                    ]
                });

                routes.push({
                    type: 'train',
                    name: 'ì§€í•˜ì²  2í˜¸ì„ ',
                    time: '45ë¶„',
                    distance: '28.3km',
                    waypoint: { lat: mid2Lat, lng: mid2Lng },
                    points: [
                        [mid1Lat, mid1Lng],
                        [mid2Lat, mid2Lng]
                    ]
                });

                routes.push({
                    type: 'walk',
                    name: 'ë„ë³´ ì´ë™',
                    time: '8ë¶„',
                    distance: '650m',
                    points: [
                        [mid2Lat, mid2Lng],
                        [end.lat, end.lng]
                    ]
                });
            }

            return routes;
        }

        function getTransportColor(type) {
            const colors = {
                bus: '#4caf50',
                train: '#2196f3',
                plane: '#ff9800',
                walk: '#9e9e9e'
            };
            return colors[type] || '#666';
        }

        function displayRouteInfo(routes, startTime) {
            const routeInfo = document.getElementById('routeInfo');
            const routeDetails = document.getElementById('routeDetails');

            let totalTime = 0;
            let html = '';
            let currentTime = new Date(startTime);

            routes.forEach((route, index) => {
                const timeInMinutes = parseInt(route.time);
                currentTime = new Date(currentTime.getTime() + timeInMinutes * 60000);

                html += `
                    <div class="route-segment">
                        <div class="route-icon">${transportIcons[route.type]}</div>
                        <div class="route-details">
                            <h4>
                                <span class="transport-${route.type}">${route.name}</span>
                            </h4>
                            <p>â±ï¸ ${route.time} | ğŸ“ ${route.distance}</p>
                            <p>ğŸ• ${currentTime.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</p>
                        </div>
                    </div>
                `;
            });

            routeDetails.innerHTML = html;
            routeInfo.style.display = 'block';
        }

        function showRecommendations(location, interests, foodPrefs) {
            const recPanel = document.getElementById('recommendations');
            const recList = document.getElementById('recommendationsList');

            // ìœ„ì¹˜ ê¸°ë°˜ ì¶”ì²œ ì°¾ê¸°
            let recs = [];
            for (const [loc, places] of Object.entries(recommendations)) {
                if (loc.includes(location) || location.includes(loc.replace('ì—­', ''))) {
                    recs = places;
                    break;
                }
            }

            // ê¸°ë³¸ ì¶”ì²œ (ìœ„ì¹˜ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°)
            if (recs.length === 0) {
                recs = recommendations['ì„œìš¸ì—­'];
            }

            // ì·¨í–¥ í•„í„°ë§
            const allPrefs = [...interests, ...foodPrefs];
            if (allPrefs.length > 0) {
                const filteredRecs = recs.filter(rec => allPrefs.includes(rec.type));
                if (filteredRecs.length > 0) {
                    recs = filteredRecs;
                }
            }

            // HTML ìƒì„±
            let html = '';
            recs.slice(0, 5).forEach(rec => {
                html += `
                    <div class="recommendation-item">
                        <h4>${rec.name}</h4>
                        <p>${rec.desc} â€¢ ${rec.category}</p>
                    </div>
                `;
            });

            recList.innerHTML = html || '<p>ì´ ì§€ì—­ì˜ ì¶”ì²œ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            recPanel.style.display = 'block';
        }

        // í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ê¸°ë³¸ê°’ ì„¤ì •
        window.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('departureTime').value = now.toISOString().slice(0, 16);
        });
    </script>
</body>
</html>
